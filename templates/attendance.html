{% extends "base.html" %}

{% block title %}Smart Attendance - College ERP System{% endblock %}

{% block extra_css %}
<style>
    .attendance-container {
        padding: 2rem 0;
        min-height: calc(100vh - 80px);
    }

    .page-header {
        text-align: center;
        margin-bottom: 3rem;
        animation: fadeInDown 1s ease-out;
    }

    .page-title {
        font-size: 3rem;
        font-weight: 700;
        background: linear-gradient(135deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 1rem;
    }

    .page-subtitle {
        font-size: 1.2rem;
        color: rgba(255, 255, 255, 0.9);
        font-weight: 400;
    }

    /* Attendance Stats */
    .attendance-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
        margin-bottom: 3rem;
    }

    .stat-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-radius: 20px;
        padding: 2rem;
        text-align: center;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        overflow: hidden;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 6px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        transform: scaleX(0);
        transform-origin: left;
        transition: transform 0.3s ease;
    }

    .stat-card:hover {
        transform: translateY(-10px) scale(1.02);
        box-shadow: 0 25px 80px rgba(0, 0, 0, 0.15);
    }

    .stat-card:hover::before {
        transform: scaleX(1);
    }

    .stat-card:nth-child(1) { animation-delay: 0.1s; }
    .stat-card:nth-child(2) { animation-delay: 0.2s; }
    .stat-card:nth-child(3) { animation-delay: 0.3s; }
    .stat-card:nth-child(4) { animation-delay: 0.4s; }

    .stat-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
        background: linear-gradient(135deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        animation: pulse 2s infinite;
    }

    .stat-number {
        font-size: 2.5rem;
        font-weight: 800;
        color: #333;
        margin-bottom: 0.5rem;
        background: linear-gradient(135deg, #667eea, #764ba2);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    .stat-label {
        color: #666;
        font-weight: 600;
        font-size: 1rem;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    /* Face Recognition Section */
    .face-recognition {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-radius: 20px;
        padding: 2rem;
        margin-bottom: 3rem;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        animation: slideInUp 0.8s ease-out;
    }

    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 2px solid rgba(102, 126, 234, 0.1);
    }

    .section-title {
        font-size: 1.8rem;
        font-weight: 700;
        color: #333;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .camera-container {
        position: relative;
        max-width: 500px;
        margin: 0 auto;
        border-radius: 16px;
        overflow: hidden;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .camera-preview {
        width: 100%;
        height: 300px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.2rem;
        position: relative;
    }

    .camera-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        border: 3px dashed rgba(255, 255, 255, 0.5);
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .face-detection-box {
        position: absolute;
        border: 2px solid #00ff00;
        border-radius: 8px;
        background: rgba(0, 255, 0, 0.1);
        animation: pulse 1s infinite;
    }

    .recognition-status {
        position: absolute;
        top: 1rem;
        right: 1rem;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .status-detecting {
        background: rgba(255, 193, 7, 0.1);
        color: #ffc107;
        border: 2px solid rgba(255, 193, 7, 0.2);
    }

    .status-recognized {
        background: rgba(86, 171, 47, 0.1);
        color: #56ab2f;
        border: 2px solid rgba(86, 171, 47, 0.2);
    }

    .status-error {
        background: rgba(255, 65, 108, 0.1);
        color: #ff416c;
        border: 2px solid rgba(255, 65, 108, 0.2);
    }

    .camera-controls {
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin-top: 2rem;
    }

    .btn {
        padding: 1rem 2rem;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        min-width: 150px;
        justify-content: center;
    }

    .btn-primary {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
    }

    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
    }

    .btn-success {
        background: linear-gradient(135deg, #56ab2f, #a8e6cf);
        color: white;
    }

    .btn-success:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(86, 171, 47, 0.3);
    }

    .btn-danger {
        background: linear-gradient(135deg, #ff416c, #ff4b2b);
        color: white;
    }

    .btn-danger:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(255, 65, 108, 0.3);
    }

    /* Attendance Records */
    .attendance-records {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-radius: 20px;
        padding: 2rem;
        margin-bottom: 3rem;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        animation: slideInUp 0.8s ease-out;
    }

    .records-table-container {
        overflow-x: auto;
        border-radius: 12px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }

    .records-table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        border-radius: 12px;
        overflow: hidden;
    }

    .records-table th {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        font-weight: 600;
        padding: 1.5rem 1rem;
        text-align: left;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .records-table td {
        padding: 1.5rem 1rem;
        border-bottom: 1px solid #f0f0f0;
        vertical-align: middle;
    }

    .records-table tr {
        transition: all 0.3s ease;
    }

    .records-table tr:hover {
        background: rgba(102, 126, 234, 0.05);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .records-table tr:last-child td {
        border-bottom: none;
    }

    /* Status Badges */
    .status-badge {
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.8rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .status-present {
        background: rgba(86, 171, 47, 0.1);
        color: #56ab2f;
        border: 2px solid rgba(86, 171, 47, 0.2);
    }

    .status-absent {
        background: rgba(255, 65, 108, 0.1);
        color: #ff416c;
        border: 2px solid rgba(255, 65, 108, 0.2);
    }

    .status-late {
        background: rgba(255, 193, 7, 0.1);
        color: #ffc107;
        border: 2px solid rgba(255, 193, 7, 0.2);
    }

    /* Student Avatar */
    .student-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea, #764ba2);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        margin-right: 1rem;
    }

    /* Recognition Result */
    .recognition-result {
        background: rgba(86, 171, 47, 0.1);
        border: 2px solid rgba(86, 171, 47, 0.2);
        border-radius: 12px;
        padding: 1.5rem;
        margin-top: 2rem;
        text-align: center;
        display: none;
    }

    .recognition-result.show {
        display: block;
        animation: slideInDown 0.5s ease-out;
    }

    .recognition-result.error {
        background: rgba(255, 65, 108, 0.1);
        border-color: rgba(255, 65, 108, 0.2);
    }

    .recognition-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea, #764ba2);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 2rem;
        font-weight: 700;
        margin: 0 auto 1rem;
    }

    .recognition-name {
        font-size: 1.5rem;
        font-weight: 700;
        color: #333;
        margin-bottom: 0.5rem;
    }

    .recognition-id {
        color: #666;
        font-size: 1rem;
        margin-bottom: 1rem;
    }

    .recognition-time {
        color: #667eea;
        font-weight: 600;
        font-size: 0.9rem;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .page-title {
            font-size: 2rem;
        }

        .attendance-stats {
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        .camera-container {
            margin: 0 1rem;
        }

        .records-table-container {
            font-size: 0.8rem;
        }

        .records-table th,
        .records-table td {
            padding: 1rem 0.5rem;
        }

        .camera-controls {
            flex-direction: column;
            align-items: center;
        }
    }

    /* Loading States */
    .loading {
        opacity: 0.6;
        pointer-events: none;
    }

    .spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 2px solid #f3f3f3;
        border-top: 2px solid #667eea;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Animations */
    @keyframes fadeInDown {
        from { opacity: 0; transform: translateY(-30px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideInUp {
        from { opacity: 0; transform: translateY(50px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideInDown {
        from { opacity: 0; transform: translateY(-30px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
    }
</style>
{% endblock %}

{% block content %}
<div class="attendance-container">
    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">
                <i class="fas fa-calendar-check"></i> Smart Attendance
            </h1>
            <p class="page-subtitle">AI-powered facial recognition attendance system</p>
        </div>

        <!-- Attendance Stats -->
        <div class="attendance-stats">
            <div class="stat-card animate-fadeInUp">
                <div class="stat-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-number">{{ attendance|length }}</div>
                <div class="stat-label">Total Records</div>
            </div>

            <div class="stat-card animate-fadeInUp">
                <div class="stat-icon">
                    <i class="fas fa-user-check"></i>
                </div>
                <div class="stat-number">{{ attendance|selectattr('status', 'equalto', 'present')|list|length }}</div>
                <div class="stat-label">Present Today</div>
            </div>

            <div class="stat-card animate-fadeInUp">
                <div class="stat-icon">
                    <i class="fas fa-user-times"></i>
                </div>
                <div class="stat-number">{{ attendance|selectattr('status', 'equalto', 'absent')|list|length }}</div>
                <div class="stat-label">Absent Today</div>
            </div>

            <div class="stat-card animate-fadeInUp">
                <div class="stat-icon">
                    <i class="fas fa-percentage"></i>
                </div>
                <div class="stat-number">{{ "%.1f"|format((attendance|selectattr('status', 'equalto', 'present')|list|length / (attendance|length or 1)) * 100) }}%</div>
                <div class="stat-label">Attendance Rate</div>
            </div>
        </div>

        <!-- Face Recognition Section -->
        <div class="face-recognition">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-camera"></i> Face Recognition Attendance
                </h2>
                <div class="recognition-status status-detecting" id="recognitionStatus">
                    <i class="fas fa-eye"></i> Detecting
                </div>
            </div>

            <div class="camera-container">
                <div class="camera-preview" id="cameraPreview">
                    <div class="camera-overlay">
                        <div style="text-align: center;">
                            <i class="fas fa-camera" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.7;"></i>
                            <div style="font-size: 1.2rem; margin-bottom: 0.5rem;">Face Recognition Camera</div>
                            <div style="font-size: 0.9rem; opacity: 0.8;">Position your face within the frame</div>
                        </div>
                    </div>
                    <div class="face-detection-box" id="faceBox" style="display: none;"></div>
                </div>
            </div>

            <div class="camera-controls">
                <button class="btn btn-primary" onclick="startCamera()" id="startBtn">
                    <i class="fas fa-play"></i> Start Camera
                </button>
                <button class="btn btn-success" onclick="markAttendance()" id="markBtn" disabled>
                    <i class="fas fa-check"></i> Mark Attendance
                </button>
                <button class="btn btn-danger" onclick="stopCamera()" id="stopBtn" disabled>
                    <i class="fas fa-stop"></i> Stop Camera
                </button>
            </div>

            <!-- Recognition Result -->
            <div class="recognition-result" id="recognitionResult">
                <div class="recognition-avatar" id="recognitionAvatar">S</div>
                <div class="recognition-name" id="recognitionName">Student Name</div>
                <div class="recognition-id" id="recognitionId">Student ID</div>
                <div class="recognition-time" id="recognitionTime">Time: 10:30 AM</div>
            </div>
        </div>

        <!-- Attendance Records -->
        <div class="attendance-records">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-list"></i> Recent Attendance Records
                </h2>
                <button class="btn btn-primary" onclick="exportAttendance()">
                    <i class="fas fa-download"></i> Export Records
                </button>
            </div>

            {% if attendance %}
            <div class="records-table-container">
                <table class="records-table">
                    <thead>
                        <tr>
                            <th>Student</th>
                            <th>Subject</th>
                            <th>Date</th>
                            <th>Time</th>
                            <th>Status</th>
                            <th>Method</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for record in attendance %}
                        <tr>
                            <td>
                                <div style="display: flex; align-items: center;">
                                    <div class="student-avatar">
                                        {{ record.student_id[-2:] }}
                                    </div>
                                    <div>
                                        <div style="font-weight: 600; color: #333;">{{ record.student_id }}</div>
                                        <div style="font-size: 0.8rem; color: #666;">Student</div>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <span style="background: rgba(102, 126, 234, 0.1); color: #667eea; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem; font-weight: 500;">
                                    {{ record.subject }}
                                </span>
                            </td>
                            <td>
                                <div style="color: #666; font-size: 0.9rem;">
                                    {{ record.date.strftime('%b %d, %Y') }}
                                </div>
                            </td>
                            <td>
                                <div style="color: #666; font-size: 0.9rem;">
                                    {{ record.date.strftime('%I:%M %p') }}
                                </div>
                            </td>
                            <td>
                                <span class="status-badge status-{{ record.status }}">
                                    {{ record.status.title() }}
                                </span>
                            </td>
                            <td>
                                <span style="background: rgba(86, 171, 47, 0.1); color: #56ab2f; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.8rem; font-weight: 500;">
                                    <i class="fas fa-camera"></i> Face Recognition
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div style="text-align: center; padding: 4rem 2rem; color: #666;">
                <i class="fas fa-calendar-check" style="font-size: 4rem; margin-bottom: 1rem; color: #ccc;"></i>
                <h3 style="font-size: 1.5rem; margin-bottom: 1rem; color: #333;">No Attendance Records</h3>
                <p style="font-size: 1rem; margin-bottom: 2rem;">Start marking attendance using the face recognition system above.</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    let cameraStream = null;
    let isDetecting = false;
    let currentStudent = null;

    // Face recognition simulation
    function startCamera() {
        const preview = document.getElementById('cameraPreview');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const markBtn = document.getElementById('markBtn');
        const status = document.getElementById('recognitionStatus');
        
        // Simulate camera starting
        preview.style.background = 'linear-gradient(135deg, #56ab2f, #a8e6cf)';
        status.textContent = 'Detecting Faces...';
        status.className = 'recognition-status status-detecting';
        
        startBtn.disabled = true;
        stopBtn.disabled = false;
        
        // Simulate face detection
        setTimeout(() => {
            showFaceBox();
            simulateFaceRecognition();
        }, 2000);
    }

    function stopCamera() {
        const preview = document.getElementById('cameraPreview');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const markBtn = document.getElementById('markBtn');
        const status = document.getElementById('recognitionStatus');
        const faceBox = document.getElementById('faceBox');
        const result = document.getElementById('recognitionResult');
        
        preview.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
        status.textContent = 'Camera Stopped';
        status.className = 'recognition-status status-error';
        
        startBtn.disabled = false;
        stopBtn.disabled = true;
        markBtn.disabled = true;
        
        faceBox.style.display = 'none';
        result.classList.remove('show');
    }

    function showFaceBox() {
        const faceBox = document.getElementById('faceBox');
        faceBox.style.display = 'block';
        faceBox.style.left = '50%';
        faceBox.style.top = '50%';
        faceBox.style.width = '120px';
        faceBox.style.height = '120px';
        faceBox.style.transform = 'translate(-50%, -50%)';
    }

    function simulateFaceRecognition() {
        const students = [
            { id: 'STU202412011', name: 'John Doe', avatar: 'J' },
            { id: 'STU202412012', name: 'Jane Smith', avatar: 'J' },
            { id: 'STU202412013', name: 'Mike Johnson', avatar: 'M' },
            { id: 'STU202412014', name: 'Sarah Wilson', avatar: 'S' },
            { id: 'STU202412015', name: 'David Brown', avatar: 'D' }
        ];

        const randomStudent = students[Math.floor(Math.random() * students.length)];
        currentStudent = randomStudent;

        const status = document.getElementById('recognitionStatus');
        const markBtn = document.getElementById('markBtn');
        
        status.textContent = 'Face Recognized';
        status.className = 'recognition-status status-recognized';
        markBtn.disabled = false;

        showRecognitionResult(randomStudent);
    }

    function showRecognitionResult(student) {
        const result = document.getElementById('recognitionResult');
        const avatar = document.getElementById('recognitionAvatar');
        const name = document.getElementById('recognitionName');
        const id = document.getElementById('recognitionId');
        const time = document.getElementById('recognitionTime');

        avatar.textContent = student.avatar;
        name.textContent = student.name;
        id.textContent = student.id;
        time.textContent = `Time: ${new Date().toLocaleTimeString()}`;

        result.classList.add('show');
    }

    function markAttendance() {
        if (!currentStudent) return;

        const result = document.getElementById('recognitionResult');
        const markBtn = document.getElementById('markBtn');
        
        markBtn.innerHTML = '<span class="spinner"></span> Marking...';
        markBtn.disabled = true;

        // Simulate attendance marking
        setTimeout(() => {
            markBtn.innerHTML = '<i class="fas fa-check"></i> Attendance Marked';
            markBtn.style.background = 'linear-gradient(135deg, #56ab2f, #a8e6cf)';
            
            // Show success message
            const successMessage = document.createElement('div');
            successMessage.innerHTML = `
                <div style="background: rgba(86, 171, 47, 0.1); border: 2px solid rgba(86, 171, 47, 0.2); border-radius: 12px; padding: 1rem; margin-top: 1rem; text-align: center; color: #56ab2f; font-weight: 600;">
                    <i class="fas fa-check-circle"></i> Attendance marked successfully for ${currentStudent.name}
                </div>
            `;
            result.appendChild(successMessage);

            // Reset after 3 seconds
            setTimeout(() => {
                resetRecognition();
            }, 3000);
        }, 1500);
    }

    function resetRecognition() {
        const markBtn = document.getElementById('markBtn');
        const result = document.getElementById('recognitionResult');
        const status = document.getElementById('recognitionStatus');
        const faceBox = document.getElementById('faceBox');
        
        markBtn.innerHTML = '<i class="fas fa-check"></i> Mark Attendance';
        markBtn.disabled = false;
        markBtn.style.background = 'linear-gradient(135deg, #56ab2f, #a8e6cf)';
        
        result.classList.remove('show');
        status.textContent = 'Detecting Faces...';
        status.className = 'recognition-status status-detecting';
        
        faceBox.style.display = 'none';
        currentStudent = null;

        // Simulate new face detection
        setTimeout(() => {
            if (!markBtn.disabled) {
                showFaceBox();
                simulateFaceRecognition();
            }
        }, 2000);
    }

    function exportAttendance() {
        alert('Export attendance records functionality would be implemented here.');
    }

    // Add animations to elements
    document.addEventListener('DOMContentLoaded', function() {
        // Animate stat cards
        const statCards = document.querySelectorAll('.stat-card');
        statCards.forEach((card, index) => {
            card.style.animationDelay = `${index * 0.1}s`;
            card.classList.add('animate-fadeInUp');
        });

        // Add hover effects to table rows
        document.querySelectorAll('.records-table tr').forEach(row => {
            row.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-2px)';
                this.style.boxShadow = '0 8px 25px rgba(0, 0, 0, 0.15)';
            });
            
            row.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
                this.style.boxShadow = 'none';
            });
        });
    });

    // Real-time updates simulation
    function simulateLiveUpdates() {
        setInterval(() => {
            // Update attendance stats randomly
            const statNumbers = document.querySelectorAll('.stat-number');
            statNumbers.forEach((stat, index) => {
                if (index === 1 || index === 2) { // Present and Absent stats
                    const current = parseInt(stat.textContent);
                    const change = Math.floor(Math.random() * 2); // 0 or 1
                    const newValue = current + change;
                    
                    if (change > 0) {
                        stat.textContent = newValue;
                        
                        // Add pulse effect
                        stat.style.animation = 'none';
                        setTimeout(() => {
                            stat.style.animation = 'pulse 0.5s ease-out';
                        }, 10);
                    }
                } else if (index === 3) { // Attendance rate
                    const current = parseFloat(stat.textContent);
                    const change = (Math.random() - 0.5) * 2; // -1 to 1
                    const newValue = Math.max(0, Math.min(100, current + change));
                    
                    stat.textContent = newValue.toFixed(1) + '%';
                }
            });
        }, 20000); // Update every 20 seconds
    }

    // Start live updates
    document.addEventListener('DOMContentLoaded', function() {
        simulateLiveUpdates();
    });
</script>
{% endblock %}
